const partnersData = [
{
        id: 1,
        name: 'Nicped Viagens e Turismo',
        segment: 'Viagem & Turismo',
        description: 'Passagem Aérea, Cruzeiros, Pacotes de Viagens para os destinos mais incríveis do Brasil e do Mundo.',
        discount: '10% para Associados ProtegeMais',
        logo: 'imagens/Nicped Viagens e Turismo/logoNicped.png',
        banner: 'imagens/Nicped Viagens e Turismo/capaNicped.png',
        phone: '19920069671',
        address: 'Av. Affonso Pansan, nº 175, Vila Bertini/Americana – SP/ CEP 13.473-620',
        city: 'Americana - SP',
        mapEmbedUrl: 'https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3680.0321524627584!2d-47.299064927488594!3d-22.72704628588198!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x94c89a085d0b6623%3A0xb44a064ff7a95b3f!2sAv.%20Afonso%20Pansan%2C%20175%20-%20Vila%20Bertini%2C%20Americana%20-%20SP%2C%2013473-620!5e0!3m2!1spt-BR!2sbr!4v1753491828711!5m2!1spt-BR!2sbr',
        featured: true,
    },
    {
        id: 2,
        name: 'DevPage',
        segment: 'Tecnologia',
        description: 'DevPage é especializada em criação de sites/landing page sob demanda',
        discount: '10% em serviços',
        logo: 'imagens/DevPage/logodevpage.png',
        banner: 'imagens/DevPage/bannerdevpage.png',
        phone: '18981167681',
        address: 'R. Itália - Jd. Paulistano, Americana - SP',
        city: 'Americana - SP',
        mapEmbedUrl: 'https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3680.0910778763573!2d-47.3342872!3d-22.724855899999998!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x94c89bb3ac0c4d87%3A0x4da0bbb69bb3b68d!2sR.%20It%C3%A1lia%2C%20351%20-%20Jardim%20Paulistano%2C%20Americana%20-%20SP%2C%2013471-550!5e0!3m2!1spt-BR!2sbr!4v1753745559290!5m2!1spt-BR!2sbr" width="600" height="450" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade',
        featured: true,
    },
    {
        id: 3,
        name: 'Programa TopRebolças',
        segment: 'Comunição & Mídia',
        description: 'Planos de Anúncios em Portal de Notícias e Programas de Rádio',
        discount: '10% nos Planos de Anúncios',
        logo: 'imagens/toprebolcas/logotoprebolcas.png',
        banner: 'imagens/toprebolcas/bannertoprebolcas.png',
        phone: '19998603454',
        address: 'Rua José Maria Barroca, 540 - Centro, Sumaré - SP',
        city: 'Sumaré - SP',
        mapEmbedUrl: 'https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3677.5315793004606!2d-47.27554982545197!3d-22.819814534767033!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x94c8bd427f17c407%3A0x18fedf3a594070f5!2sR.%20Jos%C3%A9%20Maria%20Barroca%2C%20540%20-%20Centro%2C%20Sumar%C3%A9%20-%20SP%2C%2013170-022!5e0!3m2!1spt-BR!2sbr!4v1753746219284!5m2!1spt-BR!2sbr" width="600" height="450" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade',
        featured: true,
    },
    {
        id: 4,
        name: 'Alcântara Cabeleireiro',
        segment: 'Beleza & Estética',
        description: 'Corte de cabelos masculinos adulto e criança',
        discount: '10% de desconto os cortes Masculinos',
        logo: 'logoAlcantara.png',
        phone: '19987190798',
        address: 'Av. Carlos Botelho, 1696 - Santa Rosa, Nova Odessa - SP, 13385-060',
        city: 'Nova Odessa - SP',
        mapEmbedUrl: 'https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3678.3657666119484!2d-47.28942382545311!3d-22.788906933667228!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x94c8978c0fe0d6fb%3A0x9fd555b5eb3107b6!2sAlc%C3%A2ntara%20Cabeleireiro!5e0!3m2!1spt-BR!2sbr!4v1754143067819!5m2!1spt-BR!2sbr" width="600" height="450" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade',
        featured: false,
    },
    {
        id: 5,
        name: 'Araujo Guincho Piracicaba',
        segment: 'Transporte & Logística',
        description: 'GUINCHO 24 HORAS Araújo Guincho é a sua solução confiável para todos os problemas de Guincho em Piracicaba e REGIÃO. Oferecemos uma variedade de serviços, incluindo Troca de Pneus, Reboque, Chaveiro e muito mais',
        discount: '5% em serviços',
        logo: 'logoAraujo.png',
        phone: '19998979810',
        address: 'R. das Opalas - Piracicaba SP',
        city: 'Piracicaba - SP',
        mapEmbedUrl: 'https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d2603.039089756494!2d-47.66106521581734!3d-22.681619782047857!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x94c633b926e250f1%3A0x7151f4f42c24112!2sR.%20das%20Opalas%20-%20M%C3%A1rio%20Dedini%2C%20Piracicaba%20-%20SP%2C%2013412-302!5e0!3m2!1spt-BR!2sbr!4v1754144042934!5m2!1spt-BR!2sbr" width="600" height="450" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade',
        featured: false,
    },
    {
        id: 6,
        name: 'Digo Guinchos 24h',
        segment: 'Transporte & Logística',
        description: 'Será oferecio um trabalho com rapidez, qualidade e um desconto de 10% em parceria com a ProtegeMais',
        discount: '10% nos serviços',
        logo: 'logoDigo.png',
        //banner: 'logoDigo.png',
        phone: '19992248323',
        address: 'R. Thomaz Panaro, 615 - Jardim Brasil, Americana - SP, 13474-080',
        city: 'Americana - SP',
        mapEmbedUrl: 'https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3675.253012920407!2d-43.1843236845013!3d-22.90394334356779!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x997f7e9c5a0b9b%3A0x2d174a7b9a5b9c5c!2sAv.%20Copacabana%2C%20700%2C%20Rio%20de%20Janeiro%20-%20RJ!5e0!3m2!1spt-BR!2sbr!4v1620000000003!5m2!1spt-BR!2sbr',
        featured: true,
    },
    {
        id: 7,
        name: 'ITA Guincho Piracicaba',
        segment: 'Transporte & Logística',
        description: 'Guincho 24h - Troca de Pneu = Patins - Aulixio Pane Seca',
        discount: 'A consultar',
        logo: 'logoITA.png',
        phone: '19997981020',
        address: 'R. Urbâno Gobete, 95 - Piracicaba SP',
        city: 'Piracicaba - SP
        mapEmbedUrl: 'https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3679.5938107199427!2d-47.67618972545489!3d-22.7433341320484!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x94c6312646da145f%3A0xb758779bfba3cf8f!2sR.%20Urb%C3%A2no%20Gobete%20-%20Piracicaba%2C%20SP%2C%2013402-292!5e0!3m2!1spt-BR!2sbr!4v1754145331172!5m2!1spt-BR!2sbr" width="600" height="450" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade',
        featured: false,
    }

];

document.addEventListener('DOMContentLoaded', () => {
    const partnersGrid = document.getElementById('partners-grid');
    const searchInput = document.getElementById('search-input');
    const cityFilter = document.getElementById('city-filter');
    const segmentFiltersContainer = document.getElementById('segment-filters');
    const carouselInner = document.querySelector('.carousel-inner');
    const modal = document.getElementById('partner-modal');
    const closeModalButton = document.querySelector('.close-button');

    let activeSegment = 'Todos';

    // --- RENDER FUNCTIONS --- //
    const renderCards = (partners) => {
        partnersGrid.innerHTML = '';
        if (partners.length === 0) {
            partnersGrid.innerHTML = '<p>Nenhum parceiro encontrado.</p>';
            return;
        }
        partners.forEach(partner => {
            const card = document.createElement('div');
            card.className = 'partner-card';
            card.innerHTML = `
                <div class="partner-card-logo">
                    <img src="${partner.logo}" alt="Logo ${partner.name}">
                </div>
                <h3>${partner.name}</h3>
                <p class="segment">${partner.segment}</p>
                <span class="discount">${partner.discount}</span>
            `;
            card.addEventListener('click', () => openModal(partner));
            partnersGrid.appendChild(card);
        });
    };
    
  const renderCarousel = () => {
    const featuredPartners = partnersData.filter(p => p.featured && p.banner);
    carouselInner.innerHTML = '';

    if (featuredPartners.length > 0) {
        let currentIndex = 0;

        const createBanner = (partner) => {
            const banner = document.createElement('div');
            banner.className = 'carousel-banner';
            banner.style.flex = '0 0 100%';
            banner.innerHTML = `<img src="${partner.banner}" alt="Banner ${partner.name}">`;
            banner.addEventListener('click', () => openModal(partner));
            return banner;
        };

        featuredPartners.forEach(partner => {
            carouselInner.appendChild(createBanner(partner));
        });

        // Estilos do container pra animação funcionar
        carouselInner.style.display = 'flex';
        carouselInner.style.transition = 'transform 0.5s ease-in-out';
        carouselInner.style.width = '100%';

        // Troca de banner a cada 3 segundos
        setInterval(() => {
            currentIndex = (currentIndex + 1) % featuredPartners.length;
            carouselInner.style.transform = `translateX(-${currentIndex * 100}%)`;
        }, 3000);
    }
};
    
    const renderFilters = () => {
        // Render Segment Filters
        const segments = ['Todos', ...new Set(partnersData.map(p => p.segment))];
        segmentFiltersContainer.innerHTML = '';
        segments.forEach(segment => {
            const button = document.createElement('button');
            button.className = 'tag-btn';
            button.textContent = segment;
            if (segment === activeSegment) {
                button.classList.add('active');
            }
            button.addEventListener('click', () => {
                activeSegment = segment;
                filterAndRender();
                renderFilters(); // Re-render to update active class
            });
            segmentFiltersContainer.appendChild(button);
        });

        // Render City Filter
        const cities = ['Todas as Cidades', ...new Set(partnersData.map(p => p.city))];
        cityFilter.innerHTML = '';
        cities.forEach(city => {
            const option = document.createElement('option');
            option.value = city;
            option.textContent = city;
            cityFilter.appendChild(option);
        });
    };

    // --- FILTER LOGIC --- //
    const filterAndRender = () => {
        const searchTerm = searchInput.value.toLowerCase();
        const selectedCity = cityFilter.value;
        let filteredPartners = partnersData;

        // Filter by segment
        if (activeSegment !== 'Todos') {
            filteredPartners = filteredPartners.filter(p => p.segment === activeSegment);
        }

        // Filter by city
        if (selectedCity !== 'Todas as Cidades') {
            filteredPartners = filteredPartners.filter(p => p.city === selectedCity);
        }

        // Filter by search term
        if (searchTerm) {
            filteredPartners = filteredPartners.filter(p => 
                p.name.toLowerCase().includes(searchTerm)
            );
        }
        
        renderCards(filteredPartners);
    };

    // --- MODAL LOGIC --- //
    const openModal = (partner) => {
        document.getElementById('modal-partner-name').textContent = partner.name;
        document.getElementById('modal-partner-segment').textContent = partner.segment;
        document.getElementById('modal-partner-description').textContent = partner.description;
        document.getElementById('modal-partner-address').textContent = `Endereço: ${partner.address}`;
        document.getElementById('modal-map').src = partner.mapEmbedUrl;
        
        const routeButton = document.getElementById('modal-route-button');
        routeButton.href = `https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(partner.address)}`;

        const whatsappButton = document.getElementById('modal-whatsapp-button');
        whatsappButton.href = `https://wa.me/55${partner.phone}`;
        
        modal.classList.add('show');
    };

    const closeModal = () => {
        modal.classList.remove('show');
        document.getElementById('modal-map').src = ''; // Stop map loading
    };

    // --- EVENT LISTENERS --- //
    searchInput.addEventListener('input', filterAndRender);
    cityFilter.addEventListener('change', filterAndRender);
    closeModalButton.addEventListener('click', closeModal);
    modal.addEventListener('click', (e) => {
        if (e.target === modal) {
            closeModal();
        }
    });

    // --- INITIALIZATION --- //
    renderCarousel();
    renderFilters();
    filterAndRender();
});
